/*! obs-model-validation 0.2.0 Copyright (c) 2013 Alan Plum. MIT licensed. */define(function(e,t){function n(t,n){try{return e(t)}catch(r){return n}}function a(e){var t,n,r;e.valid=s.computed(function(){for(var t in e.model.attrs)if(!e[t].valid())return!1;return!0});for(t in e.model.attrs)n=e.model.attrs[t]||{},r=e[t],r.valid=s.computed({read:a.createValidator(n,r),context:e}),r.valid.watch(r),e.valid.watch(r.valid),e._destructors.push(a.createDestructor(r,e.valid));for(t in e.model.validations){n=e.model.validations[t];for(var i=0;i<n.props.length;i++){r=e[n.props[i]],r.valid.read.validations.push(a.createModelValidation(n,e));for(var o=0;o<n.props.length;o++){if(i===o)continue;r.valid.watch(e[n.props[o]])}}}for(t in e.model.attrs)e[t].notify();e._destructors.push(function(){for(var t in e.model.validations){var n=e.model.validations[t];for(var r=0;r<n.props.length;r++){var i=e[n.props[r]];for(var s=0;s<n.props.length;s++){if(r===s)continue;i.valid.unwatch(e[n.props[s]])}}}})}var r=e("assimilate"),i=e("equals"),s=e("obs"),o=n("xregexp",RegExp),u=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"};o.XRegExp&&(o=o.XRegExp),r(a,{EXEMPT:"exempt",createValidator:function(e,t){var n=[];n.push(function(t){return t===null||t===undefined?e.required?!1:a.EXEMPT:!0}),e.values&&n.push(function(t){for(var n=0;n<e.values.length;n++)if(i(t,e.values[n]))return a.EXEMPT;return null}),e.type&&n.push(function(t){if(u(e.type)){for(var n=0;n<e.type.length;n++)if(a.hasType(e.type[n],t))return!0;return!1}return a.hasType(e.type,t)}),e.lengthRange&&n.push(function(t){return typeof t.length!="number"?!1:e.lengthRange.min!==undefined&&t.length<e.lengthRange.min?!1:e.lengthRange.max!==undefined&&t.length>e.lengthRange.max?!1:!0}),e.valueRange&&n.push(function(t){var n=0;if(typeof t!="number")return!1;if(e.valueRange.min!==undefined){n=e.valueRange.min;if(e.valueRange.minExclusive){n+=1;if(t<=e.valueRange.min)return!1}else if(t<e.valueRange.min)return!1}if(e.valueRange.max!==undefined)if(e.valueRange.maxExclusive){if(t>=e.valueRange.max)return!1}else if(t>e.valueRange.max)return!1;return e.valueRange.step!==undefined?(t-n)%e.valueRange.step===0:e.valueRange.multipleOf!==undefined?t%e.valueRange.multipleOf===0:!0});if(e.pattern){var s=typeof e.pattern=="string"?new o(e.pattern):e.pattern;n.push(function(e){return s.test(e)})}return e.validate&&n.push(e.validate),r(function(){var e=t(),r=!0;for(var i=0;i<n.length;i++){r=n[i].call(this,e);if(r===a.EXEMPT||r===!1)return r===a.EXEMPT}return r===!0},{validations:n})},createModelValidation:function(e,t){return function(){var n=[];for(var r=0;r<e.props.length;r++)n.push(t[e.props[r]]());return e.validate.apply(t,n)}},createDestructor:function(e,t){return function(){e.valid.unwatch(e),t.unwatch(e.valid)}},contributeToModel:function(e){r(e,{validations:[],validation:function(e,t){return this.validations.push({validate:e,props:t}),this}})},hasType:function(e,t){return e==="integer"?typeof t=="number"&&t===Math.floor(t):typeof e=="string"?typeof t===e:t instanceof e}}),t.validation=a});