/*! obs-model-validation 0.3.0 Copyright (c) 2013 Alan Plum. MIT licensed. @preserve */
!function(e){var n=function(n){return e[n]},t={};function r(e,t){try{return n(e)}catch(r){return t}}var a=n("aug"),i=n("equals"),u=n("obs"),l=r("xregexp",RegExp),f=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"};if(l.XRegExp){l=l.XRegExp}function o(e){var n=[],t,r,a;e.valid=u.computed(function(){for(var n in e.model.attrs){if(!e[n].valid()){return false}}return true});for(t in e.model.attrs){r=e.model.attrs[t]||{};a=e[t];a.valid=u.computed({read:o.createValidator(r,a),context:e});a.valid.watch(a);e.valid.watch(a.valid);n.push(a)}for(t in e.model.validations){r=e.model.validations[t];for(var i=0;i<r.props.length;i++){a=e[r.props[i]];a.valid.read.validations.push(o.createModelValidation(r,e));for(var l=0;l<r.props.length;l++){if(i===l){continue}a.valid.watch(e[r.props[l]])}}}for(t in e.model.attrs){e[t].notify()}e._destructors.push(function(){var t,r,a,i,u;for(t=0;t<n.length;t++){r=n[t];r.valid.unwatch(r);e.valid.unwatch(r.valid)}for(a in e.model.validations){i=e.model.validations[a];for(t=0;t<i.props.length;t++){r=e[i.props[t]];for(u=0;u<i.props.length;u++){if(t===u){continue}r.valid.unwatch(e[i.props[u]])}}}})}a(o,{EXEMPT:"exempt",createValidator:function(e,n){var t=[];t.push(function(n){if(n===null||n===undefined){return e.required?false:o.EXEMPT}return true});if(e.values){t.push(function(n){for(var t=0;t<e.values.length;t++){if(i(n,e.values[t])){return o.EXEMPT}}return null})}if(e.type){t.push(function(n){if(f(e.type)){for(var t=0;t<e.type.length;t++){if(o.hasType(e.type[t],n)){return true}}return false}else{return o.hasType(e.type,n)}})}if(e.lengthRange){t.push(function(n){if(typeof n.length!=="number"){return false}if(e.lengthRange.min!==undefined){if(n.length<e.lengthRange.min){return false}}if(e.lengthRange.max!==undefined){if(n.length>e.lengthRange.max){return false}}return true})}if(e.valueRange){t.push(function(n){var t=0;if(typeof n!=="number"){return false}if(e.valueRange.min!==undefined){t=e.valueRange.min;if(e.valueRange.minExclusive){t+=1;if(n<=e.valueRange.min){return false}}else if(n<e.valueRange.min){return false}}if(e.valueRange.max!==undefined){if(e.valueRange.maxExclusive){if(n>=e.valueRange.max){return false}}else if(n>e.valueRange.max){return false}}if(e.valueRange.step!==undefined){return(n-t)%e.valueRange.step===0}if(e.valueRange.multipleOf!==undefined){return n%e.valueRange.multipleOf===0}return true})}if(e.pattern){var r=typeof e.pattern==="string"?new l(e.pattern):e.pattern;t.push(function(e){return r.test(e)})}if(e.validate){t.push(e.validate)}return a(function(){var e=n(),r=true;for(var a=0;a<t.length;a++){r=t[a].call(this,e);if(r===o.EXEMPT||r===false){return r===o.EXEMPT}}return r===true},{validations:t})},createModelValidation:function(e,n){return function(){var t=[];for(var r=0;r<e.props.length;r++){t.push(n[e.props[r]]())}return e.validate.apply(n,t)}},contributeToModel:function(e){a(e,{validations:[],validation:function(e,n){this.validations.push({validate:e,props:n});return this}})},hasType:function(e,n){if(e==="integer"){return typeof n==="number"&&n===Math.floor(n)}else if(typeof e==="string"){return typeof n===e}else{return n instanceof e}}});t.exports=o;e.obsModelValidation=t.exports}(this);