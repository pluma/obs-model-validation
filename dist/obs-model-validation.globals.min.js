/*! obs-model-validation 0.1.0 Copyright (c) 2013 Alan Plum. MIT licensed. */(function(e){function r(e,n){try{return t(e)}catch(r){return n}}function f(e){var t,n,r;e.valid=o.computed(function(){for(var t in e.model.attrs)if(!e[t].valid())return!1;return!0});for(t in e.model.attrs)n=e.model.attrs[t]||{},r=e[t],r.valid=o.computed({read:f.createValidator(n,r),context:e}),r.valid.watch(r),e.valid.watch(r.valid),e._destructors.push(f.createDestructor(r,e.valid));for(t in e.model.validations){n=e.model.validations[t];for(var i=0;i<n.props.length;i++){r=e[n.props[i]],r.valid.read.validations.push(f.createModelValidation(n,e));for(var s=0;s<n.props.length;s++){if(i===s)continue;r.valid.watch(e[n.props[s]])}}}for(t in e.model.attrs)e[t].notify();e._destructors.push(function(){for(var t in e.model.validations){var n=e.model.validations[t];for(var r=0;r<n.props.length;r++){var i=e[n.props[r]];for(var s=0;s<n.props.length;s++){if(r===s)continue;i.valid.unwatch(e[n.props[s]])}}}})}var t=function(t){return e[t]},n=e.obs-model-f={},i=t("assimilate"),s=t("equals"),o=t("obs"),u=r("xregexp",RegExp),a=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"};u.XRegExp&&(u=u.XRegExp),i(f,{EXEMPT:"exempt",createValidator:function(e,t){var n=[];n.push(function(t){return t===null||t===undefined?e.required?!1:f.EXEMPT:!0}),e.values&&n.push(function(t){for(var n=0;n<e.values.length;n++)if(s(t,e.values[n]))return f.EXEMPT;return null}),e.type&&n.push(function(t){if(a(e.type)){for(var n=0;n<e.type.length;n++)if(f.hasType(e.type[n],t))return!0;return!1}return f.hasType(e.type,t)}),e.lengthRange&&n.push(function(t){return typeof t.length!="number"?!1:e.lengthRange.min!==undefined&&t.length<e.lengthRange.min?!1:e.lengthRange.max!==undefined&&t.length>e.lengthRange.max?!1:!0}),e.valueRange&&n.push(function(t){var n=0;if(typeof t!="number")return!1;if(e.valueRange.min!==undefined){n=e.valueRange.min;if(e.valueRange.minExclusive){n+=1;if(t<=e.valueRange.min)return!1}else if(t<e.valueRange.min)return!1}if(e.valueRange.max!==undefined)if(e.valueRange.maxExclusive){if(t>=e.valueRange.max)return!1}else if(t>e.valueRange.max)return!1;return e.valueRange.step!==undefined?(t-n)%e.valueRange.step===0:e.valueRange.multipleOf!==undefined?t%e.valueRange.multipleOf===0:!0});if(e.pattern){var r=typeof e.pattern=="string"?new u(e.pattern):e.pattern;n.push(function(e){return r.test(e)})}return e.validate&&n.push(e.validate),i(function(){var e=t(),r=!0;for(var i=0;i<n.length;i++){r=n[i].call(this,e);if(r===f.EXEMPT||r===!1)return r===f.EXEMPT}return r===!0},{validations:n})},createModelValidation:function(e,t){return function(){var n=[];for(var r=0;r<e.props.length;r++)n.push(t[e.props[r]]());return e.validate.apply(t,n)}},createDestructor:function(e,t){return function(){e.valid.unwatch(e),t.unwatch(e.valid)}},contributeToModel:function(e){i(e,{validations:[],validation:function(e,t){return this.validations.push({validate:e,props:t}),this}})},hasType:function(e,t){return e==="integer"?typeof t=="number"&&t===Math.floor(t):typeof e=="string"?typeof t===e:t instanceof e}}),n.validation=f})(this);